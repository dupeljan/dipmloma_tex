\documentclass[oneside,final,14pt]{extreport}

%% my command
%%%%%%%%%%%%%%
% Путь к файлу с изображениями
\newcommand{\picPath}{pictures}
% Величина отступа
\newcommand{\indentSpace}{1.25cm}
% Сокращения
\newcommand{\urlTitle}{ $-$ URL: }
%%%%%%%%%%%%%%%


% Изменяем шрифт
\usepackage{fontspec}
\setmainfont{Times New Roman}
\listfiles

% Полуторный интервал
\linespread{1.6}

% Отступ
\setlength\parindent{\indentSpace}

% Математика
\usepackage{mathtools}


% Картинки
\usepackage{graphicx}
\usepackage{subcaption}

% Языковой пакет
\usepackage[russianb]{babel}

% Таблицы
\usepackage{tabularx}

% Настройка подписей к фигурам
% Меняем заголовки картинок
\usepackage[ labelsep= endash]{caption}
\captionsetup{%
   figurename= Рисунок,
   tablename= Таблица,
   justification= centering% Формат - по центру
}         

% Кирилица в подфигурах
\renewcommand{\thesubfigure}{\asbuk{subfigure}}
% разделитель в подфигурах - правая скобка
\DeclareCaptionLabelSeparator{r_paranthesis}{)\quad }
\captionsetup[subfigure]{labelformat=simple, labelsep=r_paranthesis}

% Добавляем итератор \asbuk,
% чтобы использовать кирилицу
% как маркеры
\usepackage{enumitem}
\makeatletter
\AddEnumerateCounter{\asbuk}{\russian@alph}{щ}
\makeatother

% Меняем маркеры в перечислениях
% Списки уровня 1
\setlist[enumerate,1]{label=\arabic*),ref=\arabic*}
% Списки уровня 2
\setlist[enumerate,2]{label=\asbuk*),ref=\asbuk*}
% Перечисления
\setlist[itemize,1]{label=$-$}
% Удаляем отступы перед и после
% списка
\setlist[itemize]{noitemsep, topsep=0pt}
\setlist[enumerate]{noitemsep, topsep=0pt}

% Красная строка в начале главы
\usepackage{indentfirst}

% Убиваем перенос
\usepackage[none]{hyphenat}

% Перенос длинных ссылок
\usepackage[hyphens]{url}
\urlstyle{same}

% Выравнивание по ширине
\usepackage{microtype}

%\usepackage[fontfamily=courier]{fancyvrb}
%\usepackage{verbatim}%     configurable verbatim
% \makeatletter
%  \def\verbatim@font{\normalfont\sffamily% select the font
%                     \let\do\do@noligs
%                     \verbatim@nolig@list}
%\makeatother

% Границы
\usepackage{vmargin}
\setpapersize{A4}
% отступы
%\setmarginsrb 
%{3cm} % левый
%{2cm} % верхний
%{1cm} % Правый
%{2cm} % Нижний
%{0pt}{0mm} % Высота - отступ верхнего колонтитула
%{0pt}{0mm} % Высота - отступ нижнего  колонтитула

\setlength\hoffset{0cm}
\setlength\voffset{0cm}
\usepackage[top=2cm, bottom=2cm, left=3cm, right=2cm,
]{geometry}
 		
% Настройка заглавиий
\addto\captionsrussian{% Replace "english" with the language you use
  \renewcommand{\contentsname}% содержания
    {\hfill\bfseries
    СОДЕРЖАНИЕ
	\hfill    
    }%
   \renewcommand{\bibname}% списка источников
    {\hfill\bfseries
    	СПИСОК ИСПОЛЬЗОВАННЫХ ИСТОЧНИКОВ
	\hfill
	}% 
}%\

%\renewcommand{\contentsname}{\hfill\bfseries СОДЕРЖАНИЕ \hfill} 

% Настройка  заглавий в главах
\usepackage{titlesec}


%\titleformat
%{\chapter} % command
%[display]
%{
%\bfseries
%} % format
%{
%\thechapter.
%} 	% label
%{ 
%	0 pt
%} % sep
%{    
%\centering
%} % before-code

\titleformat{\chapter}
            {\bfseries}
            {\hspace{\indentSpace}\thechapter\hspace{1em}}
            {0pt}
            {
            \vspace{0mm} }
            [\vspace{14pt}]% Отступ после
% Начальный сдвиг заголовка 50 pt = 1.763888888cm.
% Второй параметр- сдвиг до = 2cm - 50pt
\titlespacing{\chapter}{0pt}{-0.2361cm}{0pt}

\titleformat{\section}
{\bfseries}{\hspace{\indentSpace}\thesection}{1em}{}

\titleformat{\subsection}
{\bfseries}{\hspace{\indentSpace}\thesubsection}{1em}{}

%\titleformat{\section}
%            {\bfseries}
%            {\thechapter.\hspace{1em}}
%            {0pt}
%            {\centering
%            \vspace{0mm} }
%            [\vspace{14pt}]% Отступ после
%\titlespacing{\section}{0pt}{-50pt}{0pt}

% Конец настройка заглавий

% Форматирование списка источников
\makeatletter
\renewcommand*{\@biblabel}[1]{\hfill#1}
\makeatother

% Убрать отсупы в списке источников
\usepackage{lipsum}

% ADD THE FOLLOWING COUPLE LINES INTO YOUR PREAMBLE
\let\OLDthebibliography\thebibliography
\renewcommand\thebibliography[1]{
  \OLDthebibliography{#1}
  \setlength{\parskip}{0pt}
  \setlength{\itemsep}{0pt plus 0.3ex}
}



% Добавить точки в оглавление
\usepackage{tocstyle}
\newcommand{\autodot}{.}


% Чтобы картинки вставляись
% куда надо
\usepackage{float}

% Для вычисления кол-ва страниц
\usepackage{lastpage}

% Для вычисления кол-ва рисунков и таблиц
%%%
\usepackage{etoolbox}

\newcounter{totfigures}
\newcounter{tottables}

\providecommand\totfig{} 
\providecommand\tottab{}

\makeatletter
\AtEndDocument{%
  \addtocounter{totfigures}{\value{figure}}%
  \addtocounter{tottables}{\value{table}}%
  \immediate\write\@mainaux{%
    \string\gdef\string\totfig{\number\value{totfigures}}%
    \string\gdef\string\tottab{\number\value{tottables}}%
  }%
}
\makeatother

\pretocmd{\chapter}{\addtocounter{totfigures}{\value{figure}}\setcounter{figure}{0}}{}{}
\pretocmd{\chapter}{\addtocounter{tottables}{\value{table}}\setcounter{table}{0}}{}{}
%%%

% Режим релиза
\sloppy
\usepackage{layout}

%\renewcommand{\arraystretch}{1.6}

\newcommand{\cmmnt}[1]{\ignorespaces}
\newcommand{\bs}{\boldsymbol}
\usepackage{breqn}
\begin{document}
\chapter{Кинематическая модель робота с N всенаправленными колесами}   
Для того, чтобы описать движения робота необходимо некоторым образом смоделировать его поведение. Простейший модель движения робота в пространстве - кинематическая. Эта модель описывает движения исключительно через зависимость координат от времени. То есть в кинематической модели рассматривается движение тела, но не рассматриваются причины, его создающие.

Рассмотрим движение тележки с $N$ всенаправленными колесами ($N > 3$) по гладкой двумерной поверхности без учета действующих сил, причем плоскости колес тележки вертикальны и неподвижны относительно платформы тележки. В рамках модели всенаправленные колеса способны скользить в любом направлении с пренебрежимо малой силой трения. Пусть задана глобальная система координат, связанная с поверхностью $\{o,\boldsymbol{x},\bs{y},\bs{z}\}$ и локальная,  инерциальная относительно глобальной, жестко связанная с тележкой $\{c,\bs{x_{l}},\bs{y_{l}},\bs{z_{l}}\}$, причем плоскость $\bs{x_{l}}\bs{y_{l}}$  параллельна плоскости $\bs{x}\bs{y}$ . Не теряя общности начало локальных координат положим в точке центра масс тележки. Положение тележки определено вектором координат $(x,y,\varphi)$
где $x,y$ - координаты, и $\varphi$ -  угол между осью $\bs{ox}$ и $\bs{cx_{l}}$. Скорость тележки определяется вектором $(\dot{x},\dot{y},\omega)$ где $\omega = \dot{\varphi}$ - угловая скорость тележки. 

Обозначим за $\{c_{i},\bs{x_{w,i}},\bs{y_{w,i}},\bs{z_{w,i}}\}$ - локальную систему координат $i$ - го колеса, изображенная на рисунке \ref{fig:omni_wheel_coords}, где $c_{i}$ - ось вращения, $\bs{x_{w,i}}$  - ось, направленная из $c_{i}$  в сторону точки касания с поверхностью, $\bs{y_{w,i}}$ - ось, параллельная поверхности качения, направленная вправо, $\bs{z_{w,i}} = \bs{x_{w,i}} \times \bs{y_{w,i}}$.  

Для примера на рисунке \ref{fig:kinematic_model} схематически изображена кинематическая модель робота с тремя всенаправленными колесами.
\begin{figure}[H]
\centering{
\resizebox{140mm}{!}{\input{kinematic_model_pic.pdf_tex}}
\caption{ кинематическая модель тележки с тремя всенаправленными колесами.}
\label{fig:kinematic_model}
}
\end{figure}

\begin{figure}[H]
\centering{
\resizebox{40mm}{!}{\input{omni_wheel_coords.pdf_tex}}
\caption{ координатные оси $i$ - го колеса.}
\label{fig:omni_wheel_coords}
}
\end{figure}


Рассмотрим вектор скорости $i$- го колеса, $\bs{v_{i}}$, $i = \overline{1,N}$. Он направлен по касательной к диску $i$ - го колеса $\bs{y_{w,i}}$. Разложим его на поступательную и  вращательную составляющие:
\begin{equation}
\bs{v_{i}}
=
\bs{v_{i,tr}}
+
\bs{v_{i,rot}}
\end{equation}

Обозначим за $\alpha_{i}$ - угол между $\bs{y_{w,i}}$ и осью $\bs{y_{l}}$, что изображено на рисунке \ref{fig:kinematic_model}. 




Рассмотрим вектор поступательной скорости тележки $\bs{v_{tr}}=[\dot{x},\dot{y},0]$. Для того, чтобы тележка имела скорость $\bs{v_{tr}}$, вектор скорости $i$ - го колеса должен быть равен проекции $\bs{v_{tr}}$ на направление $\bs{y_{w,i}}$. Вектор поступательной скорости $i$ - го составляет с осью $\bs{y}$  угол $\varphi + \alpha_{i}$, что проиллюстрировано на рисунке \ref{fig:projection}. Тогда $\bs{v_{tr,i}}$ может быть представлен в виде
\begin{equation}
\label{eq:v_rt_i_global}
\bs{v_{tr,i}} 
=
[
-sin(\varphi +\alpha_{i})
\dot{x}
+
cos(\varphi +\alpha_{i})
\dot{y}
]
\bs{y_{w,i}}
\end{equation} 



\begin{figure}[H]
\centering{
\resizebox{80mm}{!}{\input{projection.pdf_tex}}
\caption{ расположение векторов модели в плоскости}
\label{fig:projection}
}
\end{figure} 

Обозначим $\bs{R_{i}}$ - радиус вектор оси $i$-го колеса от оси вращения  (точки центра масс) длинны $R_{i}$. Для того, чтобы заставить тележку вращаться вокруг оси вращения $C\bs{z_{l}}$, необходимо задать вектор скоростей каждого колеса перпендикулярно $\bs{R_{i}}$. При этом длинна вектора должна составлять $R_{i}\omega$.
Таким образом скорости вращательного движения $i$ - го задается следующим уравнением
\begin{equation}
\bs{v_{rot,i}}
=
\bs{R_{i}}
\times
\omega
\bs{z}
\end{equation}

\begin{figure}[H]
\centering{
\resizebox{100mm}{!}{\input{mecanum_wheel_projection3.pdf_tex}}
\caption{ проекция вектора вращательной скорости  $i$ - го колеса на глобальную систему координат}
\label{fig:mecanum_wheel_projection3}
}
\end{figure}

Обозначим $\gamma_{i}$ - угол между осью $\bs{y}$ и  $\bs{R_{i}}$. Тогда сперва проецируя $\bs{v_{rot,i}}$   на  $\bs{xy}$, как показано на рисунке \ref{fig:mecanum_wheel_projection3}, получим
\begin{equation}
\bs{v_{rot,i}}
=
R_{i}
\omega
[
-cos(\gamma_{i})
\bs{x}
-
sin(\gamma_{i})
\bs{y}
]
\end{equation}

Проецируя $\bs{v_{rot,i}}$ на направление $\bs{y_{w,i}}$, аналогично уравнению \ref{eq:v_rt_i_global}, получим
\begin{center}
$
\bs{v_{rot,i}}
=
R_{i}
\omega
[
sin(\varphi + \alpha_{i})
cos(\gamma_{i})
-
cos(\varphi+\alpha_{i})
sin(\gamma_{i})
]
\bs{y_{w,i}}
$
\end{center}
\begin{equation}
\bs{v_{rot,i}}
=
R_{i}
\omega
sin(\varphi+\alpha_{i}-\gamma_{i})
\bs{y_{w,i}}
\end{equation}
Нетрудно видеть, что угол $\theta_{i} = \gamma_{i} -\varphi = const$ есть угол между $\bs{R_{i}}$ и $\bs{y_{l}}$, следовательно коэффициент вектора угловой скорости не зависит от $\varphi$ в общем случае. Если же касательная диска $i$ - го колеса $y_{w,i}$  перпендикулярна $R_{i}$, то $\alpha_{i} - \theta_{i} = \frac{\pi}{2}, \bs{v_{rot,i}} = R_{i}\omega$. 
\iffalse
 Кроме того, справедливо 
\begin{gather}
\dot{x}
=
v_{x}\bs{x}
\\
\dot{y}
=
v_{y}\bs{y}
\\
\dot{\varphi}
=
\omega\bs{z}
\end{gather}
Где  $v_{x}$, $v_{x}$, $\omega$ - величина скорости по направлению $\bs{x}$ и $\bs{y}$ соответственно, $\omega$ - величина угловой скорости.
\fi 

Таким образом вектор скорости $i$ - го колеса можно записать в виде:
\begin{equation}
\label{eq:local_v_global}
\bs{v_{i}}
=
[
-sin(\varphi +\alpha_{i})\dot{x}
+cos(\varphi +\alpha_{i})\dot{y}
+
R_{i}
\omega
sin(\alpha_{i} - \theta_{i})
]
\bs{y_{w,i}}
\end{equation}




Соотнесем величину скорости $i$ - го колеса с его угловой скоростью
\begin{equation}
\label{eq:local_v_local}
\bs{v_{i}}
=
\bs{r_{i}}
\times
\omega_{i}
\bs{z_{w,i}}
\end{equation}

Где $\bs{r_{i}}$  - вектор, имеющий координаты $[-r_{i},0,0]$ в системе координат $i$-го колеса тележки, $r_{i}$ - радиус $i$ -го колеса тележки, $\omega_{i}$ - угловая скорость этого колеса.
Вычисляя векторное произведение в \ref{eq:local_v_local}, получим
\begin{equation}
\label{eq:local_v_local_res}
\bs{v_{i}}
=
\bs{r_{i}}
\times
\omega_{i}
\bs{z_{w,i}}
=
\omega_{i}
r_{i}
\bs{y_{w,i}}
\end{equation}
% получим зависимость величины угловой скорости колеса от тройки  $(\dot{x},\dot{y},\omega)$

Таким образом, выражая из \ref{eq:local_v_local_res} $w_{i}$, подставляя $\bs{v_{i}}$ из \ref{eq:local_v_global}, получим:
\begin{equation}
\omega_{i}
=
\frac{1}{r_{i}}
(
-sin(\varphi +\alpha_{i})\dot{x}
+cos(\varphi +\alpha_{i})\dot{y}
+
R_{i}
\omega
sin(\alpha_{i} - \theta_{i})
)
\end{equation}

или в матричной форме 

\begin{equation}
\label{kinematic_omniwheel_res}
\begin{bmatrix}
\omega_{1} \\
\omega_{2} \\
...\\
\omega_{N}
\end{bmatrix}
=
\begin{bmatrix}
-\frac{1}{r_{1}}sin(\varphi +\alpha_{1}) &
\frac{1}{r_{1}}cos(\varphi +\alpha_{1}) &
\frac{1}{r_{1}}R_{1}sin(\alpha_{1} - \theta_{1})
\\
-\frac{1}{r_{2}}sin(\varphi +\alpha_{2}) &
\frac{1}{r_{2}}cos(\varphi +\alpha_{2}) &
\frac{1}{r_{2}}R_{2}sin(\alpha_{2} - \theta_{2})
\\
... & ... & ...
\\
-\frac{1}{r_{N}}sin(\varphi +\alpha_{N}) &
\frac{1}{r_{N}}cos(\varphi +\alpha_{N}) &
\frac{1}{r_{N}}R_{N}sin(\alpha_{N} - \theta_{N})
\end{bmatrix}
\begin{bmatrix}
\dot{x} \\
\dot{y} \\
\omega
\end{bmatrix}
\end{equation}
Таким образом, зная координаты траектории пути $(x,y,\varphi)$ можем получить величину угловой скорость каждого колеса. Для этого необходимо вычислить $(\dot{x},\dot{y},\omega)$ и подставить в формулу \ref{kinematic_omniwheel_res}.

\iffalse
Кроме того, переходя к локальным координатам

\begin{equation}
\begin{bmatrix}
\dot{x} \\
\dot{y} \\
\omega
\end{bmatrix}
=
\begin{bmatrix}
cos(\varphi) & 0 & 0 \\
0 & cos(\varphi) & 0 \\
0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
\dot{x_{l}} \\
\dot{y_{l}} \\
\omega
\end{bmatrix}
\end{equation}

Получаем уравнение движения тележки в локальной системе координат
\begin{equation}
\begin{bmatrix}
\dot{\phi_{1}} \\
\dot{\phi_{2}} \\
...\\
\dot{\phi_{N}}
\end{bmatrix}
=
\begin{bmatrix}
-\frac{1}{r_{1}}sin(\varphi +\alpha_{1}) &
\frac{1}{r_{1}}cos(\varphi +\alpha_{1}) &
\frac{1}{r_{1}}R_{1}sin(\alpha_{1} - \theta_{1})
\\
-\frac{1}{r_{2}}sin(\varphi +\alpha_{2}) &
\frac{1}{r_{2}}cos(\varphi +\alpha_{2}) &
\frac{1}{r_{2}}R_{2}sin(\alpha_{2} - \theta_{2})
\\
... & ... & ...
\\
-\frac{1}{r_{N}}sin(\varphi +\alpha_{N}) &
\frac{1}{r_{N}}cos(\varphi +\alpha_{N}) &
\frac{1}{r_{N}}R_{N}sin(\alpha_{N} - \theta_{N})
\end{bmatrix}
\begin{bmatrix}
cos(\varphi) & 0 & 0 \\
0 & cos(\varphi) & 0 \\
0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
\dot{x_{l}} \\
\dot{y_{l}} \\
\omega
\end{bmatrix}
\end{equation}

где $\dot{x_{l}}$,$\dot{y_{l}}$ - величина скорости по направлению $X_{l}$ и  $Y_{l}$ соответственно.
\fi

\chapter{Динамическая модель робота с N всенаправленными колесами}
Динамическая модель, в отличие от кинематической, рассматривает движение твердых тел с учетом сил, приводящих это тело в движение.
 
Для того, чтобы привести тележку в движение, её колесам необходимо передать крутящий момент $T$. Увеличивая скорость тележки, мы преодолеваем её сопротивления покоя и придаем ей ускорение. 
 
Рассмотрим движение тележки с $N$ всенаправленными колесами ($N > 3$) по негладкой двумерной поверхности с учетом действующих сил. В описании модели используются те же обозначения, что и в кинематической модели. Для примера на рисунке \ref{fig:dynamic_model} схематически изображена динамическая модель робота с тремя всенаправленными колесами. Рассмотрим равнодействующую всех сил, действующих на тележку $F$. Сила как мера воздействия на тело характеризует поступательное движение модели, в то время как момент сил характеризует вращательное движение. Равнодействующую всех сил можно разложить на поступательную и вращательную составляющие, аналогично кинематической модели, следующим образом:
\begin{equation}
F
=
\begin{bmatrix}
F_{X} \\
F_{Y} \\
M_{t}
\end{bmatrix}
=
\begin{bmatrix}
M & 0 & 0 \\
0 & M & 0 \\
0 & 0 & J
\end{bmatrix}
\cdot
\begin{bmatrix}
\ddot{x} \\
\ddot{y} \\
\dot{\omega}
\end{bmatrix}
=
B \cdot \ddot{u}
\end{equation}

Где $M$ - масса тележки, $J$ - её момент инерции. 

\begin{figure}[H]
\centering{
\resizebox{140mm}{!}{\input{dynamic_model_pic.pdf_tex}}
\caption{ динамическая модель тележки с тремя всенаправленными колесами}
\label{fig:dynamic_model}
}
\end{figure}
Момент инерции тележки можно считать приближенно равным моменту инерции однородного цилиндра радиуса $R=max_{i}(R_{i})$ 
\begin{equation}
J
=
\frac{1}{2}
MR^{2}
\end{equation}



Аналогично кинематической модели,
проецируя поступательный вектор силы на $[X,Y]$,  используя свойство ассоциативности моментов сил
можно представить компоненты вектора $F$ как сумму проекций на соответствующие оси:

\begin{equation}
F_{X}
=
-
\sum_{i=1}^{N}f_{i} sin(\varphi +\alpha_{i})
\end{equation}
\begin{equation}
F_{Y}
=
\sum_{i=1}^{N}f_{i} cos(\varphi +\alpha_{i})
\end{equation}
\begin{equation}
M_{t}
=
\sum_{i=1}^{N}f_{i}R_{i}
\end{equation}
где $f_{i}$ - сила, приложенная верхней точке $i$ - го колеса. 

Записывая в матричной форме
\begin{equation}
\begin{bmatrix}
F_{X} \\
F_{Y} \\
M_{t}
\end{bmatrix}
=
\begin{bmatrix}
-sin(\varphi + \alpha_{1}) &
-sin(\varphi + \alpha_{2}) &
... 					   &
-sin(\varphi + \alpha_{N}) \\
cos(\varphi + \alpha_{1}) &
cos(\varphi + \alpha_{2}) &
... 					   &
cos(\varphi + \alpha_{N}) \\ 
R_{1} & R_{2} & ... & R_{N}
\end{bmatrix}
\begin{bmatrix}
f_{1} \\
f_{2} \\
...   \\
f_{n}
\end{bmatrix}
=
Af
\end{equation}

Получаем уравнение
\begin{equation}
F = Af
\label{eq:f}
\end{equation}

Разрешая уравнение \ref{eq:f} относительно $f$, получим
\begin{equation}
f
=
A^{-1}
\cdot
F
=
A^{-1}
\cdot
B 
\cdot
\ddot{u}
\end{equation}

Зная, что вращающий момент колеса равен силе, приложенной в его верхней точке на его радиус и обозначая 
\begin{equation}
\overline{r} 
=
\begin{bmatrix}
r_{1} \\
r_{2} \\
... \\
r_{N}
\end{bmatrix}
\end{equation}
получим зависимость координат пути $(x,y,\varphi)$ от крутящих моментов каждого колеса:
\begin{equation}
\label{eq:dynamic_w_friction}
\begin{bmatrix}
T_{1} \\
T_{2} \\
... \\
T_{N}
\end{bmatrix}
=
\overline{r}
f^{T}
=
\overline{r}
(
A^{-1}
\cdot
B 
\cdot
\ddot{u}
)^{T}
\end{equation}

В свою очередь величину момента сил каждого колеса можно выразить через его угловое ускорение:

\begin{equation}
T_{i}
=
J_{i}\dot{\omega_{i}}
\end{equation}

$J_{i}$ - момент инерции $i$-го колеса

Учтем силу трения качения модели по некоторой поверхности, предполагая равномерное распределение веса на каждое колесо. Известно, что сила трения качения противоположна по направлению силе, приводящей колесо в действие и для $i$-го колеса может быть вычислена по формуле:
\begin{equation}
f_{t_{i}}
=
\frac{Mg\eta}{Nr_{i}}
\end{equation}

Где $Mg$ - сила реакции опоры, равная силе тяжести, $\eta$ - коэффициент трения качения, зависящий от характеристик поверхности. 
Сила трения качения направлена в противоположную сторону от направления движения колеса. Поэтому для того, чтобы её компенсировать, необходимо увеличить силу, приложенную в верхней точке колеса на величину силы трения.
\begin{equation}
\tilde{f_{i}}
=
f_{i}
+
f_{i_{t}}
\end{equation}

Обозначим 
\begin{equation}
\tilde{f}
=
f
+
\begin{bmatrix}
f_{t_{1}} \\
f_{t_{2}} \\
... \\
f_{t_{N}}
\end{bmatrix}
=
f
+
\frac{Mg\eta}{N}
\cdot
\begin{bmatrix}
\frac{1}{r_{1}} \\
\frac{1}{r_{2}} \\
...				\\
\frac{1}{r_{N}}
\end{bmatrix}
\end{equation}
Тогда заменяя в формуле \ref{eq:dynamic_w_friction} $f$ на $\tilde{f}$, получим зависимость момента сил каждого колеса от координат пути, учитывающая силу трения:
\begin{equation}
\begin{bmatrix}
T_{1} \\
T_{2} \\
... \\
T_{N}
\end{bmatrix}
=
\overline{r}
(
A^{-1}
\cdot
B 
\cdot
\ddot{u}
+
\frac{Mg\eta}{N}
\cdot
\begin{bmatrix}
\frac{1}{r_{1}} \\
\frac{1}{r_{2}} \\
...				\\
\frac{1}{r_{N}}
\end{bmatrix}
)^{T}
\end{equation} 

Таким образом получаем динамическую модель тележки, учитывающую её массу и силу трения качения. 

\iffalse
В работе ref более детально рассматривается динамическая модель тележки на N роликонесущих колесах.  Модель тележки строится исходя из предположения о том, что модель роликонесущего колеса — твердый диск, скорость наинизшей точки которого перпендикулярна направлению оси ролика в этой точке. Кроме того, рассмотрен критерий управляемости такой модели, из которого следует ряд ограничений на его конструкцию. Например если сумма угла оси ролика и угла поворота колеса всех роликонесущих колес равна, то такая модель не может двигаться по произвольной трактории. Если же эти углы у двух колес совпадают, то пару колес можно принять за одно виртуальное колесо с радиус вектором $r_{ij} = r_{i} - r_{j}$ в локальной системе координат и моментом $T_{ij} = T_{i} + T_{j}$.
\fi
\chapter{Кинематическая модель роликонесущего колеса} 
Для нероликового колеса, которое вращается по поверхности без скольжения, мгновенная скорость низшей точки касания равна нулю[Ссылка на источник]. На практике соприкасающиеся тела из-за физических ограничений всегда соприкасаются множеством точек, называемым пятном контакта. В качестве иллюстрации можно привести гусеничную тележку, двигающуюся по поверхности без просткальзываний. Пятно касания гусеницы достаточно большое чтобы заметить, что в определенное мгновение оно не двигается относительно поверхности. При достаточно низкой скорости тележки можно даже заметить, что некоторая подобласть пятна касания гусеницы не двигается относительно поверхности некоторый промежуток времени. 

Особенность роликонесущих колес заключается в том, что мговенная точка касания имеет ненулевую скорость относительно поверхности качения, так как укрепленные на колесе ролики под силой тяжести тележки вращаются относительно своей оси. В случае всенаправленного колеса, оси роликов которого параллельны плоскости диска колеса, проскальзывания не происходит, что упрощает процесс построения математической модели

 Простейшей неголономной моделью роликонесущего колеса является плоский диск, для которого скорость точки соприкосновения с несущей поверхностью направленная вдоль прямой, составляющий постоянный угол с плоскостью колеса.

\begin{figure}[H]
\centering{
\resizebox{160mm}{!}{\input{mecanum_disk.pdf_tex}}
\caption{модель роликового колеса: вид сбоку}
\label{fig:mecanum_disk_side}
}
\end{figure}

\begin{figure}[H]
\centering{
\resizebox{130mm}{!}{\input{mecanum_wheel_top.pdf_tex}}
\caption{ модель роликового колеса: вид сверху}
\label{fig:mecanum_disk_top}
}
\end{figure}

 В качестве модели роликонесущего колеса рассмотрим диск радиуса $R$ с центром в точке $C$, причем плоскости колес тележки вертикальны и неподвижны относительно платформы тележки. Обозначим за $l$ - единичный вектор оси вращения ролика, $\tau$ - касательная к плоскости диска, $\delta = \widehat{l \tau}$.Тогда уравнение связи записывается следующим образом:
\begin{equation}
v_{M}
\cdot
l
=
0
\end{equation}
где $M$ - точка касания,$v_{M}$ - скорость точки касания. Вектор $v_{M}$ определяется следующим образом:
\begin{equation}
v_{M}
=
v_{C}
+
\omega
\times
\overrightarrow{CM}
\end{equation}
 $v_{C}$ -   
скорость центра колеса и  $\omega$ - угловая скорость колеса.
Обозначим $\{O,e_{x},e_{y},e_{z}\}$ - глобальная инерциальная система координат, $\{C,E_{x},E_{y},E_{z}\}$ - система координат, жестко связанная с диском. Плоскость $\{C,E_{x},E_{y}\}$ параллельна плоскости поверхности. Обозначим $\varphi$ - угол поворота диска вокруг перпендикулярной плоскости диска оси, проходящей через точку $C$ против часовой стрелки, $\psi = \widehat{\tau e_{x}}$. Обозначения проиллюстрированы на рисунках \ref{fig:mecanum_disk_side} и \ref{fig:mecanum_disk_top}. Тогда вектора $\omega$ и $\overrightarrow{CM}$ примут вид:
\begin{equation}
\omega
=
\dot{\varphi}
E_{y}
+
\dot{\psi}
E_{z}
\end{equation}
\begin{equation}
\overrightarrow{CM}
=
-R
E_{z}
\end{equation}

Отсюда справедливо
\begin{equation}
\omega
\times
\overrightarrow{CM}
=
-R\dot{\varphi}
E_{x}
\end{equation} 

Обозначая за $x_{C}$ $y_{C}$ координаты точки $C$ в глобальных координатах, проектируя вектор скорости точки $C$ на локальную систему координат, что проиллюстрировано на рисунке \ref{fig:mecanum_wheel_projection}, можем записать
\begin{equation}
\label{eq:velocity_c_projection}
v_{C}
=
(
\dot{x_{C}}
cos\psi
+
\dot{y_{C}}
sin\psi
)
E_{x}
+
(
-\dot{x_{C}}
sin\psi
+
\dot{y_{C}}
cos\psi
)
E_{y}
\end{equation}

\begin{figure}[H]
\centering{
\resizebox{100mm}{!}{\input{mecanum_wheel_projection.pdf_tex}}
\caption{ иллюстрация проектирования вектора скорости на локальную систему координат}
\label{fig:mecanum_wheel_projection}
}
\end{figure}

 Наконец, проецируя единичный вектор $l$ на локальную систему координат 
\begin{equation}
l
=
cos\delta
E_{x}
+
sin\delta
E_{y}
\end{equation}
Можем записать уравнение связи в виде
\begin{flushleft}
$
v_{m}
\cdot
l
=
(
v_{c}
+
\omega
\times
\overrightarrow{CM}
,
l
)
=
$

$
(
(
\dot{x_{C}}
cos\psi
+
\dot{y_{C}}
sin\psi
-R\dot{\varphi}
)
E_{x}
+
(
-\dot{x_{C}}
sin\psi
+
\dot{y_{C}}
cos\psi
)
E_{y}
,
cos\delta
E_{x}
+
sin\delta
E_{y}
)
=
$

$
(
\dot{x_{C}}
cos\psi
+
\dot{y_{C}}
sin\psi
-R\dot{\varphi}
)
cos\delta
+
(
-\dot{x_{C}}
sin\psi
+
\dot{y_{C}}
cos\psi
)
sin\delta
=
0
$
\end{flushleft}
\begin{equation}
\label{eq:mecanum_final}
\dot{x_{C}}
cos(\psi+\delta)
+
\dot{y_{C}}
sin(\psi+\delta)
=
R\dot{\varphi}
cos\delta
\end{equation}

Уравнение \ref{eq:mecanum_final} связывает между собой тройку координат $(x_{C},y_{C},\psi)$ с угловой скоростью колеса $\varphi$. В работе [ссылка на источник] изучена динамика тележки с $N$ роликонесущими колесами и сформулирован критерий управляемости:
если $N \geq 3$, хотя бы одна пара векторов  $l_{i}, l_{j}$ $i,j=\overline{1,N}$, которые соответствуют осям роликов, не параллельна и точки контакта колес не лежат на одной прямой, то для любой траектории всегда возможно найти такие управляющие моменты (то есть функции $\varphi_{i}(t)$), что тележка, управляемая этими моментами, переместится по заданной траектории.

\chapter{Кинематическая модель тележки на четырех роликонесущих колесах}
Рассмотрим кинематическую модель тележки на четырех роликонесущих колесах, проиллюстрированную на рисунке  \ref{fig:mecanum_car}. Обозначим $C$ - точка вращения тележки, $\{O,e_{x},e_{y},e_{z}\}$ - глобальная инерциальная система координат, $\{C,E_{x},E_{y},E_{z}\}$ - система координат, жестко связанная с тележкой. Плоскость $\{C,E_{x},E_{y}\}$ параллельна плоскости поверхности. Обозначим $\delta_{i}$ - угол между плоскость колеса $p_{i}$ и осью ролика $l_{i}$\cmmnt{, $\delta_{i} = \widehat{p_{i} l_{i}}$ }, $\psi$ - угол между осью $e_{x}$ и $E_{x}$\cmmnt{, $\psi$ = $\widehat{e_{x}E{x}}$}, $\alpha_{i}$ - угол между осью $E_{x}$ и радиус вектором, направленным из точки $C$ в точку касания с поверхностью $i$-го колеса $C_{i}$\cmmnt{,$\alpha_{i} = \widehat{E_{x}\overrightarrow{C C_{i}}}$}, $i=\overline{1,4}$. 

\begin{figure}[H]
\centering{
\resizebox{170mm}{!}{\input{mecanum_car.pdf_tex}}
\caption{ модель тележки на четырех роликонесущих колесах }
\label{fig:mecanum_car}
}
\end{figure}

Рассмотрим вектор скорости центра $i$-го колеса $v_{c,i}$. Разложим его на поступательную и вращательную составляющие:
\begin{equation}
\label{eq:mec_wheel_v_decomp}
v_{c,i}
=
v_{tr,i}
+
v_{rot,i}
\end{equation}

Вектор поступательной скорости $v_{tr,i}$ задается парой $(\dot{x_{tr,i}},\dot{y_{tr,i}})$. Уравнение связи с угловой скоростью $i$ - го колеса $\varphi_{i}$, основываясь на уравнении \ref{eq:mecanum_final} имеет вид:
\begin{equation}
\dot{x_{tr,i}}
cos(\psi+\delta)
+
\dot{y_{tr,i}}
sin(\psi+\delta)
=
R\dot{\varphi_{i}}
cos\delta
\end{equation}

Для того, чтобы заставить тележку вращаться вокруг оси вращения $CE_{z}$, необходимо задать вектор скоростей каждого колеса перпендикулярно радиус вектору $\overrightarrow{C C_{i}}$.При этом длинна вектора должна составлять $R_{i},\dot{\psi}$, где $R_{i}=|\overrightarrow{C C_{i}}|$. Расположение векторов проиллюстрировано на  рисунке \ref{fig:mecanum_car_rot}.

\begin{figure}[H]
\centering{
\resizebox{150mm}{!}{\input{mecanum_car_rot.pdf_tex}}
\caption{ иллюстрация вращательного движения тележки на четырех роликонесущих колесах}
\label{fig:mecanum_car_rot}
}
\end{figure}

Рассмотрим вектор вращательной скорости $i$ - го колеса $v_{rot,i}$. Проектируя его на оси $E_{x}$ $E_{y}$, как показано на рисунке \ref{fig:mecanum_wheel_projection1}, получим:
\begin{equation}
v_{rot,i}
=
R_{i}
\dot{\psi}
sin(\alpha_{i})
E_{x}
-
R_{i}
\dot{\psi}
cos(\alpha_{i})
E_{y}
\end{equation}

\begin{figure}[H]
\centering{
\resizebox{80mm}{!}{\input{mecanum_wheel_projection1.pdf_tex}}
\caption{ проекция вектора вращательной скорости на локальную систему координат}
\label{fig:mecanum_wheel_projection1}
}
\end{figure}

Проектируя вектор $v_{rot,i}$ на оси $e_{x}$ $e_{y}$, как показано на рисунке \ref{fig:mecanum_wheel_projection2} , получим

$
v_{rot,i}
=
R_{i}
\dot{\psi}
sin\alpha_{i}
(
cos\psi e_{x}
+
sin\psi e_{y}
)
-
R_{i}
\dot{\psi}
cos\alpha_{i}
(
-sin\psi e_{x}
+
cos\psi e_{y}
)
$
\begin{equation}
\label{eq:v_rot_global}
v_{rot,i}
=
R_{i}
\dot{\psi}
sin(\alpha_{i} + \psi)
e_{x}
-
R_{i}
\dot{\psi}
cos(\alpha_{i} + \psi)
e_{y}
\end{equation}

\begin{figure}[H]
\centering{
\resizebox{80mm}{!}{\input{mecanum_wheel_projection2.pdf_tex}}
\caption{ проекция вектора вращательной скорости на глобальную систему координат}
\label{fig:mecanum_wheel_projection2}
}
\end{figure}

Тогда подставляя \ref{eq:v_rot_global} в уравнение связи \ref{eq:mecanum_final}, получим

$
R_{i}
\dot{\psi}
sin(\alpha_{i} + \psi)
cos(\psi + \delta_{i})
-
R_{i}
\dot{\psi}
cos(\alpha_{i} + \psi)
sin(\psi + \delta_{i})
=
R\dot{\varphi_{i}}
cos\delta
$

\begin{equation}
R_{i}
\dot{\psi}
sin(\alpha_{i} - \delta_{i})
=
R
\dot{\varphi}
cos\delta
\end{equation}

Таким образом, уравнение связи для $v_{i}$, исходя из \ref{eq:mec_wheel_v_decomp}, примет вид
\begin{equation}
\dot{x_{tr,i}}
cos(\psi+\delta_{i})
+
\dot{y_{tr,i}}
sin(\psi+\delta_{i})
+
R_{i}
\dot{\psi}
sin(\alpha_{i}-\delta_{i})
=
R\dot{\varphi_{i}}
cos\delta
\end{equation}

\end{document}